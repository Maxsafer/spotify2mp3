<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube Song Downloader</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    pre#logContent { white-space: pre-wrap; }
  </style>
</head>
<body class="bg-light">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <span class="navbar-brand">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-music-note-beamed me-2" viewBox="0 0 16 16">
          <path d="M6 13c0 1.105-1.12 2-2.5 2S1 14.105 1 13s1.12-2 2.5-2S6 11.895 6 13ZM14 11a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM6 3v8h1V3h8V2H6v1Z"/>
        </svg>
        YouTube Song Downloader
      </span>
    </div>
  </nav>

  <!-- Main -->
  <main class="container my-4">
    <div class="row g-4">
      <!-- Single Song(s) -->
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header">
            <h5 class="mb-0">Download Single Song(s)</h5>
          </div>
          <div class="card-body">
            <div class="mb-3 form-floating">
              <textarea class="form-control" placeholder="Enter song names, one per line" id="songInput" style="height: 160px"></textarea>
              <label for="songInput">Song names (one per line)</label>
              <div class="form-text">Paste multiple titles — one per line — to download in batch.</div>
            </div>

            <div class="mb-3">
              <label for="maxFilesize" class="form-label">Max file size</label>
              <div class="input-group">
                <input type="number" class="form-control" id="maxFilesize" value="20" min="1" />
                <span class="input-group-text">MB</span>
              </div>
            </div>

            <div class="d-grid">
              <button class="btn btn-primary" id="downloadSongBtn">
                Download Song(s)
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Playlist -->
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header">
            <h5 class="mb-0">Download Spotify Playlist</h5>
          </div>
          <div class="card-body">
            <div class="mb-3 form-floating">
              <input type="text" class="form-control" id="playlistInput" placeholder="Enter playlist ID" />
              <label for="playlistInput">Playlist ID</label>
              <div class="form-text">Provide a public Spotify playlist ID (or URL).</div>
            </div>

            <div class="mb-3">
              <label for="maxFilesizePlaylist" class="form-label">Max file size</label>
              <div class="input-group">
                <input type="number" class="form-control" id="maxFilesizePlaylist" value="20" min="1" />
                <span class="input-group-text">MB</span>
              </div>
            </div>

            <div class="d-grid">
              <button class="btn btn-success" id="downloadPlaylistBtn">
                Download Spotify Playlist
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Downloading Modal (acts as overlay/spinner) -->
  <div class="modal fade" id="downloadingModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow">
        <div class="modal-body text-center py-5">
          <div class="spinner-border mb-3" role="status" aria-hidden="true"></div>
          <h5 class="mb-0">Downloading…</h5>
          <small class="text-muted">Please keep this tab open.</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Log Modal -->
  <div class="modal fade" id="logModal" tabindex="-1" aria-labelledby="logModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="logModalLabel">Download Log</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <pre id="logContent" class="mb-0"></pre>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (with Popper) -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>

  <script>
    // Confirmation alert when leaving the page
    window.onbeforeunload = function() {
      return "Are you sure you want to leave? Your download may be in progress.";
    };

    // Bootstrap modals
    const downloadingModalEl = document.getElementById("downloadingModal");
    const logModalEl = document.getElementById("logModal");

    const downloadingModal = new bootstrap.Modal(downloadingModalEl);
    const logModal = new bootstrap.Modal(logModalEl);

    function showModal(logText) {
      document.getElementById("logContent").textContent = logText || "";
      logModal.show();
    }

    function showOverlay() { downloadingModal.show(); }
    function hideOverlay() { downloadingModal.hide(); }

    function downloadItem(mode, query, maxFilesize) {
      showOverlay();
      fetch("/download_item", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mode: mode, query: query, maxfilesize: maxFilesize })
      })
      .then(res => res.json())
      .then(data => {
        hideOverlay();
        showModal(data && data.log ? data.log : "No log returned.");
      })
      .catch(error => {
        hideOverlay();
        showModal("Error: " + error);
      });
    }

    document.getElementById("downloadSongBtn").addEventListener("click", function() {
      const song = document.getElementById("songInput").value;
      const maxFilesize = document.getElementById("maxFilesize").value;
      if (!song.trim()) {
        return alert("Please enter at least one song name");
      }
      downloadItem("song", song, maxFilesize);
    });

    document.getElementById("downloadPlaylistBtn").addEventListener("click", function() {
      const playlist = document.getElementById("playlistInput").value;
      const maxFilesize = document.getElementById("maxFilesizePlaylist").value;
      if (!playlist.trim()) {
        return alert("Please enter a playlist ID");
      }
      downloadItem("playlist", playlist, maxFilesize);
    });
  </script>
</body>
</html>